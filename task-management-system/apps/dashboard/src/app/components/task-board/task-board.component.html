<div class="min-h-screen bg-gray-50 p-4 sm:p-6">
  <div class="max-w-7xl mx-auto">
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-gray-900 mb-4">Task Management Board</h1>
      <div class="flex flex-col sm:flex-row gap-4 mb-4">
        <button
          *ngIf="canEdit"
          (click)="openCreateDialog()"
          class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 font-medium"
        >
          + New Task
        </button>

        <input
          type="text"
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchChange()"
          placeholder="Search tasks..."
          class="flex-1 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
        />

        <select
          [(ngModel)]="categoryFilter"
          (ngModelChange)="onCategoryFilterChange()"
          class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
        >
          <option value="">All Categories</option>
          <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
        </select>

        <button
          *ngIf="searchQuery || categoryFilter"
          (click)="clearFilters()"
          class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"
        >
          Clear Filters
        </button>
      </div>

      <p class="text-sm text-gray-600">
        Logged in as: <span class="font-medium">{{ currentUserRole }}</span>
        <span *ngIf="!canEdit" class="text-yellow-600 ml-2">(Read-only)</span>
      </p>
    </div>

    <div
      *ngIf="errorMessage"
      class="mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md"
    >
      {{ errorMessage }}
    </div>

    <div *ngIf="isLoading" class="flex justify-center items-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
    </div>

    <div *ngIf="!isLoading" class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="bg-white rounded-lg shadow p-4">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
          <span class="w-3 h-3 bg-gray-400 rounded-full mr-2"></span>
          To Do
          <span class="ml-auto text-sm font-normal text-gray-500">{{ todoTasks.length }}</span>
        </h2>
        <div
          cdkDropList
          #todoList="cdkDropList"
          [cdkDropListData]="todoTasks"
          [cdkDropListConnectedTo]="[inProgressList, doneList]"
          [cdkDropListDisabled]="!canEdit || isSaving"
          (cdkDropListDropped)="onDrop($event, TaskStatus.TODO)"
          class="min-h-[200px] space-y-3"
        >
          <div
            *ngFor="let task of todoTasks"
            cdkDrag
            [cdkDragData]="task"
            [cdkDragDisabled]="!canEdit || isSaving"
          >
            <app-task-card
              [task]="task"
              [canEdit]="canEdit"
              (edit)="openEditDialog($event)"
              (delete)="onDeleteTask($event)"
            ></app-task-card>
          </div>
          <p *ngIf="todoTasks.length === 0" class="text-gray-400 text-center py-8">
            No tasks
          </p>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow p-4">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
          <span class="w-3 h-3 bg-blue-500 rounded-full mr-2"></span>
          In Progress
          <span class="ml-auto text-sm font-normal text-gray-500">{{ inProgressTasks.length }}</span>
        </h2>
        <div
          cdkDropList
          #inProgressList="cdkDropList"
          [cdkDropListData]="inProgressTasks"
          [cdkDropListConnectedTo]="[todoList, doneList]"
          [cdkDropListDisabled]="!canEdit || isSaving"
          (cdkDropListDropped)="onDrop($event, TaskStatus.IN_PROGRESS)"
          class="min-h-[200px] space-y-3"
        >
          <div
            *ngFor="let task of inProgressTasks"
            cdkDrag
            [cdkDragData]="task"
            [cdkDragDisabled]="!canEdit || isSaving"
          >
            <app-task-card
              [task]="task"
              [canEdit]="canEdit"
              (edit)="openEditDialog($event)"
              (delete)="onDeleteTask($event)"
            ></app-task-card>
          </div>
          <p *ngIf="inProgressTasks.length === 0" class="text-gray-400 text-center py-8">
            No tasks
          </p>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow p-4">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
          <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
          Done
          <span class="ml-auto text-sm font-normal text-gray-500">{{ doneTasks.length }}</span>
        </h2>
        <div
          cdkDropList
          #doneList="cdkDropList"
          [cdkDropListData]="doneTasks"
          [cdkDropListConnectedTo]="[todoList, inProgressList]"
          [cdkDropListDisabled]="!canEdit || isSaving"
          (cdkDropListDropped)="onDrop($event, TaskStatus.DONE)"
          class="min-h-[200px] space-y-3"
        >
          <div
            *ngFor="let task of doneTasks"
            cdkDrag
            [cdkDragData]="task"
            [cdkDragDisabled]="!canEdit || isSaving"
          >
            <app-task-card
              [task]="task"
              [canEdit]="canEdit"
              (edit)="openEditDialog($event)"
              (delete)="onDeleteTask($event)"
            ></app-task-card>
          </div>
          <p *ngIf="doneTasks.length === 0" class="text-gray-400 text-center py-8">
            No tasks
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<app-task-editor
  [isOpen]="isEditorOpen"
  [task]="editingTask"
  (close)="closeEditor()"
  (save)="onSaveTask($event)"
></app-task-editor>
